#!/usr/bin/env bash

set -eux

# proxy seting
proxy=''
kindle=''
while getopts ':pP:k' OPT; do
    case $OPT in
        p) proxy="-p http://127.0.0.1:8118";;
        P) proxy="-p $OPTARG";;
        k) kindle="yes";;
        *) echo "Usage: $(basename "$0") [-p [<proxy>]] url filename";;
    esac
done
shift $(( OPTIND - 1 ))


# css setting
css_path="$HOME/Nutstore Files/Nutstore/Sync/css"
css_file="html-to-pdf.css"
[[ "$1" =~ raku\.org/ ]] && css_file='raku.org.css'
[[ "$1" =~ raku\.guide/ ]] && css_file='raku.org.css'


if [[ $kindle = 'yes' ]]; then
    /usr/bin/wkhtmltopdf "$proxy" \
        -L 0mm -R 0mm -T 0mm -B 0mm --no-background \
        --page-size A5 --user-style-sheet "$css_path/$css_file" \
        "$1" "$HOME/Downloads/${2}-kindle.pdf"
else
    /usr/bin/wkhtmltopdf "$proxy" \
        -L 10mm -R 10mm -T 10mm -B 10mm --no-background \
        --user-style-sheet "$css_path/$css_file" \
        "$1" "$HOME/Downloads/${2}.pdf"
fi

echo "Succeed!"

exit 0


