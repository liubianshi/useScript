#!/usr/bin/env bash
set -e
tag=
content=
days=0

while getopts ":d:" op; do
    case $op in
        d) days="$OPTARG";;
        *) echo "wrong option!"
           exit 1
           ;;
   esac
   shift $((OPTIND - 1))
done

if [ $# -eq 0 ]; then
    if which fortune >/dev/null 2>&1; then
        printf "%s\nğŸ“œ[1m-----------------[0m\n" "$(fortune)"
    fi
    if [ $days -eq 0 ]; then
        stup show --at today -c "plan" | sed '1d'
    elif [ $days -gt 0 ]; then
        from=$(date --date="$days days ago" +%F)
        stup log -c "plan" --from $from --to today
    else
        echo "days needed to be a non-negative interger"
        exit 2
    fi
    exit 0
elif [ $# -eq 1 ]; then
    tag="ğŸ“‹"
    content="$1"
else
    case $1 in
        p|plan|åŠ±å¿—|è®¡åˆ’|å†³å¿ƒ) tag="â›½ï¸";;
        c|code|ç¼–ç¨‹|è¯­è¨€) tag="ğŸª¡";;
        t|tool|å·¥å…·) tag="ğŸ”©";;
        r|research|ç ”ç©¶) tag="ğŸ§­";;
        i|idea|è®¾æƒ³) tag="ğŸ’¡";;
        w|write|å†™ä½œ) tag="ğŸ§±";;
        n|note|å¤‡å¿˜|ç¬”è®°) tag="ğŸ“";;
        *) cat <<-EOF
				Category:
				(p)lan|åŠ±å¿—|è®¡åˆ’|å†³å¿ƒ
				(c)ode|ç¼–ç¨‹|è¯­è¨€
				(t)ool|å·¥å…·
				(r)esearch|ç ”ç©¶
				(i)dea|æƒ³æ³•
				(w)rite|å†™ä½œ
				(n)ote|å¤‡å¿˜|ç¬”è®°
			EOF
            return 0
        ;;
    esac
    shift 1
    content="$* [$(date +'%F %T')]"
fi

stup add today --category "plan" --note "$tag $content"

exit 0

